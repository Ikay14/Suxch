{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\DELL\\\\Documents\\\\projects\\\\suxch\\\\chat-client\\\\src\\\\components\\\\Chat\\\\ChatWindow.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport './ChatWindow.css';\nimport MessageList from './MessageList';\nimport MessageInput from './MessageInput';\nimport UploadedFiles from './UploadedFiles';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SOCKET_SERVER_URL = 'http://localhost:8080/chat';\nconst ChatWindow = () => {\n  _s();\n  // ... existing state declarations ...\n\n  useEffect(() => {\n    const connectSocket = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        if (!token) {\n          navigate('/login');\n          return;\n        }\n        await socketService.initializeSocket(token);\n        const socket = socketService.socket;\n        setSocket(socket);\n        socket === null || socket === void 0 ? void 0 : socket.on('connect', () => {\n          setConnectionStatus('connected');\n          setClientId(socket.id || null);\n        });\n        socket === null || socket === void 0 ? void 0 : socket.on('disconnect', () => {\n          setConnectionStatus('disconnected');\n        });\n        socket === null || socket === void 0 ? void 0 : socket.on('new_message', message => {\n          setMessages(prev => [...prev, message]);\n        });\n        socket === null || socket === void 0 ? void 0 : socket.on('file-sent', fileMessage => {\n          setMessages(prev => [...prev, fileMessage]);\n        });\n      } catch (error) {\n        console.error('Socket connection error:', error);\n        navigate('/login');\n      }\n    };\n    connectSocket();\n    return () => {\n      const socket = socketService.socket;\n      socket === null || socket === void 0 ? void 0 : socket.off('connect');\n      socket === null || socket === void 0 ? void 0 : socket.off('disconnect');\n      socket === null || socket === void 0 ? void 0 : socket.off('new_message');\n      socket === null || socket === void 0 ? void 0 : socket.off('file-sent');\n    };\n  }, [navigate, userId, receiverId]);\n  const handleFileUpload = event => {\n    var _event$target$files;\n    if ((_event$target$files = event.target.files) !== null && _event$target$files !== void 0 && _event$target$files[0] && socket) {\n      var _userId;\n      const file = event.target.files[0];\n      setUploadedFiles(prev => [...prev, file]);\n      const formData = new FormData();\n      formData.append('file', file);\n      formData.append('senderId', (_userId = userId) !== null && _userId !== void 0 ? _userId : 'defaultUserId');\n      if (receiverId) {\n        formData.append('receiverId', receiverId);\n      }\n      socket.emit('fileUpload', formData, response => {\n        if (response.status !== 'success') {\n          console.error('File upload failed:', response.message);\n        }\n      });\n    }\n  };\n  const handleSendMessage = message => {\n    if (socket) {\n      const messageData = receiverId ? {\n        senderId: userId,\n        receiverId,\n        content: message\n      } : {\n        senderId: userId,\n        content: message\n      };\n      socket.emit('send_message', messageData, response => {\n        if (response.status !== 'success') {\n          console.error('Message sending failed:', response.message);\n        }\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: [\"Chat Room - User: \", localStorage.getItem('username')]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this), clientId && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Connection ID: \", clientId]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Status: \", connectionStatus]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-content\",\n      children: userId && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(MessageList, {\n          messages: messages,\n          currentUserId: userId\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(UploadedFiles, {\n          files: uploadedFiles\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-input-area\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"file-upload\",\n            className: \"file-upload-icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"file-upload\",\n            type: \"file\",\n            style: {\n              display: 'none'\n            },\n            onChange: handleFileUpload\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(MessageInput, {\n            onSend: handleSendMessage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 106,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatWindow, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n_c = ChatWindow;\nexport default ChatWindow;\nvar _c;\n$RefreshReg$(_c, \"ChatWindow\");","map":{"version":3,"names":["React","useEffect","MessageList","MessageInput","UploadedFiles","jsxDEV","_jsxDEV","Fragment","_Fragment","SOCKET_SERVER_URL","ChatWindow","_s","connectSocket","token","localStorage","getItem","navigate","socketService","initializeSocket","socket","setSocket","on","setConnectionStatus","setClientId","id","message","setMessages","prev","fileMessage","error","console","off","userId","receiverId","handleFileUpload","event","_event$target$files","target","files","_userId","file","setUploadedFiles","formData","FormData","append","emit","response","status","handleSendMessage","messageData","senderId","content","className","children","fileName","_jsxFileName","lineNumber","columnNumber","clientId","connectionStatus","messages","currentUserId","uploadedFiles","htmlFor","type","style","display","onChange","onSend","_c","$RefreshReg$"],"sources":["C:/Users/DELL/Documents/projects/suxch/chat-client/src/components/Chat/ChatWindow.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport './ChatWindow.css';\nimport MessageList from './MessageList';\nimport MessageInput from './MessageInput';\nimport UploadedFiles from './UploadedFiles';\nimport { FaPaperclip } from 'react-icons/fa';\nimport io, { Socket, ManagerOptions, SocketOptions } from 'socket.io-client';\n\n\nconst SOCKET_SERVER_URL = 'http://localhost:8080/chat';\n\n\ninterface ChatParams {\n  userId: string;\n  receiverId?: string;\n  [key: string]: string | undefined;\n}\n\nconst ChatWindow: React.FC = () => {\n  // ... existing state declarations ...\n\n  useEffect(() => {\n    const connectSocket = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        if (!token) {\n          navigate('/login');\n          return;\n        }\n\n        await socketService.initializeSocket(token);\n        const socket = socketService.socket;\n        setSocket(socket);\n        \n        socket?.on('connect', () => {\n          setConnectionStatus('connected');\n          setClientId(socket.id || null);\n        });\n\n        socket?.on('disconnect', () => {\n          setConnectionStatus('disconnected');\n        });\n\n        socket?.on('new_message', (message) => {\n          setMessages(prev => [...prev, message]);\n        });\n\n        socket?.on('file-sent', (fileMessage) => {\n          setMessages(prev => [...prev, fileMessage]);\n        });\n\n      } catch (error) {\n        console.error('Socket connection error:', error);\n        navigate('/login');\n      }\n    };\n\n    connectSocket();\n\n    return () => {\n      const socket = socketService.socket;\n      socket?.off('connect');\n      socket?.off('disconnect');\n      socket?.off('new_message');\n      socket?.off('file-sent');\n    };\n  }, [navigate, userId, receiverId]);\n\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (event.target.files?.[0] && socket) {\n      const file = event.target.files[0];\n      setUploadedFiles(prev => [...prev, file]);\n\n      const formData = new FormData();\n      formData.append('file', file);\n      formData.append('senderId', userId ?? 'defaultUserId');\n      if (receiverId) {\n        formData.append('receiverId', receiverId);\n      }\n\n      socket.emit('fileUpload', formData, (response: any) => {\n        if (response.status !== 'success') {\n          console.error('File upload failed:', response.message);\n        }\n      });\n    }\n  };\n\n  const handleSendMessage = (message: string) => {\n    if (socket) {\n      const messageData = receiverId \n        ? { senderId: userId, receiverId, content: message }\n        : { senderId: userId, content: message };\n\n      socket.emit('send_message', messageData, (response: any) => {\n        if (response.status !== 'success') {\n          console.error('Message sending failed:', response.message);\n        }\n      });\n    }\n  };\n\n  return (\n    <div className=\"chat-container\">\n      <div className=\"chat-header\">\n        <h1>Chat Room - User: {localStorage.getItem('username')}</h1>\n        {clientId && (\n          <div>\n            <p>Connection ID: {clientId}</p>\n            <p>Status: {connectionStatus}</p>\n          </div>\n        )}\n      </div>\n      <div className=\"chat-content\">\n        {userId && (\n          <>\n            <MessageList messages={messages} currentUserId={userId} />\n            <UploadedFiles files={uploadedFiles} />\n            <div className=\"chat-input-area\">\n              <label htmlFor=\"file-upload\" className=\"file-upload-icon\">\n              </label>\n              <input\n                id=\"file-upload\"\n                type=\"file\"\n                style={{ display: 'none' }}\n                onChange={handleFileUpload}\n              />\n              <MessageInput onSend={handleSendMessage} />\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ChatWindow;"],"mappings":";;AAAA,OAAOA,KAAK,IAAcC,SAAS,QAAqB,OAAO;AAE/D,OAAO,kBAAkB;AACzB,OAAOC,WAAW,MAAM,eAAe;AACvC,OAAOC,YAAY,MAAM,gBAAgB;AACzC,OAAOC,aAAa,MAAM,iBAAiB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAK5C,MAAMC,iBAAiB,GAAG,4BAA4B;AAStD,MAAMC,UAAoB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACjC;;EAEAV,SAAS,CAAC,MAAM;IACd,MAAMW,aAAa,GAAG,MAAAA,CAAA,KAAY;MAChC,IAAI;QACF,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;QAC3C,IAAI,CAACF,KAAK,EAAE;UACVG,QAAQ,CAAC,QAAQ,CAAC;UAClB;QACF;QAEA,MAAMC,aAAa,CAACC,gBAAgB,CAACL,KAAK,CAAC;QAC3C,MAAMM,MAAM,GAAGF,aAAa,CAACE,MAAM;QACnCC,SAAS,CAACD,MAAM,CAAC;QAEjBA,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEE,EAAE,CAAC,SAAS,EAAE,MAAM;UAC1BC,mBAAmB,CAAC,WAAW,CAAC;UAChCC,WAAW,CAACJ,MAAM,CAACK,EAAE,IAAI,IAAI,CAAC;QAChC,CAAC,CAAC;QAEFL,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEE,EAAE,CAAC,YAAY,EAAE,MAAM;UAC7BC,mBAAmB,CAAC,cAAc,CAAC;QACrC,CAAC,CAAC;QAEFH,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEE,EAAE,CAAC,aAAa,EAAGI,OAAO,IAAK;UACrCC,WAAW,CAACC,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEF,OAAO,CAAC,CAAC;QACzC,CAAC,CAAC;QAEFN,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEE,EAAE,CAAC,WAAW,EAAGO,WAAW,IAAK;UACvCF,WAAW,CAACC,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEC,WAAW,CAAC,CAAC;QAC7C,CAAC,CAAC;MAEJ,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;QAChDb,QAAQ,CAAC,QAAQ,CAAC;MACpB;IACF,CAAC;IAEDJ,aAAa,CAAC,CAAC;IAEf,OAAO,MAAM;MACX,MAAMO,MAAM,GAAGF,aAAa,CAACE,MAAM;MACnCA,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEY,GAAG,CAAC,SAAS,CAAC;MACtBZ,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEY,GAAG,CAAC,YAAY,CAAC;MACzBZ,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEY,GAAG,CAAC,aAAa,CAAC;MAC1BZ,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEY,GAAG,CAAC,WAAW,CAAC;IAC1B,CAAC;EACH,CAAC,EAAE,CAACf,QAAQ,EAAEgB,MAAM,EAAEC,UAAU,CAAC,CAAC;EAGlC,MAAMC,gBAAgB,GAAIC,KAA0C,IAAK;IAAA,IAAAC,mBAAA;IACvE,IAAI,CAAAA,mBAAA,GAAAD,KAAK,CAACE,MAAM,CAACC,KAAK,cAAAF,mBAAA,eAAlBA,mBAAA,CAAqB,CAAC,CAAC,IAAIjB,MAAM,EAAE;MAAA,IAAAoB,OAAA;MACrC,MAAMC,IAAI,GAAGL,KAAK,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC;MAClCG,gBAAgB,CAACd,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEa,IAAI,CAAC,CAAC;MAEzC,MAAME,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;MAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAEJ,IAAI,CAAC;MAC7BE,QAAQ,CAACE,MAAM,CAAC,UAAU,GAAAL,OAAA,GAAEP,MAAM,cAAAO,OAAA,cAAAA,OAAA,GAAI,eAAe,CAAC;MACtD,IAAIN,UAAU,EAAE;QACdS,QAAQ,CAACE,MAAM,CAAC,YAAY,EAAEX,UAAU,CAAC;MAC3C;MAEAd,MAAM,CAAC0B,IAAI,CAAC,YAAY,EAAEH,QAAQ,EAAGI,QAAa,IAAK;QACrD,IAAIA,QAAQ,CAACC,MAAM,KAAK,SAAS,EAAE;UACjCjB,OAAO,CAACD,KAAK,CAAC,qBAAqB,EAAEiB,QAAQ,CAACrB,OAAO,CAAC;QACxD;MACF,CAAC,CAAC;IACJ;EACF,CAAC;EAED,MAAMuB,iBAAiB,GAAIvB,OAAe,IAAK;IAC7C,IAAIN,MAAM,EAAE;MACV,MAAM8B,WAAW,GAAGhB,UAAU,GAC1B;QAAEiB,QAAQ,EAAElB,MAAM;QAAEC,UAAU;QAAEkB,OAAO,EAAE1B;MAAQ,CAAC,GAClD;QAAEyB,QAAQ,EAAElB,MAAM;QAAEmB,OAAO,EAAE1B;MAAQ,CAAC;MAE1CN,MAAM,CAAC0B,IAAI,CAAC,cAAc,EAAEI,WAAW,EAAGH,QAAa,IAAK;QAC1D,IAAIA,QAAQ,CAACC,MAAM,KAAK,SAAS,EAAE;UACjCjB,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEiB,QAAQ,CAACrB,OAAO,CAAC;QAC5D;MACF,CAAC,CAAC;IACJ;EACF,CAAC;EAED,oBACEnB,OAAA;IAAK8C,SAAS,EAAC,gBAAgB;IAAAC,QAAA,gBAC7B/C,OAAA;MAAK8C,SAAS,EAAC,aAAa;MAAAC,QAAA,gBAC1B/C,OAAA;QAAA+C,QAAA,GAAI,oBAAkB,EAACvC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;MAAA;QAAAuC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC,EAC5DC,QAAQ,iBACPpD,OAAA;QAAA+C,QAAA,gBACE/C,OAAA;UAAA+C,QAAA,GAAG,iBAAe,EAACK,QAAQ;QAAA;UAAAJ,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eAChCnD,OAAA;UAAA+C,QAAA,GAAG,UAAQ,EAACM,gBAAgB;QAAA;UAAAL,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC9B,CACN;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC,eACNnD,OAAA;MAAK8C,SAAS,EAAC,cAAc;MAAAC,QAAA,EAC1BrB,MAAM,iBACL1B,OAAA,CAAAE,SAAA;QAAA6C,QAAA,gBACE/C,OAAA,CAACJ,WAAW;UAAC0D,QAAQ,EAAEA,QAAS;UAACC,aAAa,EAAE7B;QAAO;UAAAsB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,eAC1DnD,OAAA,CAACF,aAAa;UAACkC,KAAK,EAAEwB;QAAc;UAAAR,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,eACvCnD,OAAA;UAAK8C,SAAS,EAAC,iBAAiB;UAAAC,QAAA,gBAC9B/C,OAAA;YAAOyD,OAAO,EAAC,aAAa;YAACX,SAAS,EAAC;UAAkB;YAAAE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAClD,CAAC,eACRnD,OAAA;YACEkB,EAAE,EAAC,aAAa;YAChBwC,IAAI,EAAC,MAAM;YACXC,KAAK,EAAE;cAAEC,OAAO,EAAE;YAAO,CAAE;YAC3BC,QAAQ,EAAEjC;UAAiB;YAAAoB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC5B,CAAC,eACFnD,OAAA,CAACH,YAAY;YAACiE,MAAM,EAAEpB;UAAkB;YAAAM,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACxC,CAAC;MAAA,eACN;IACH;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAAC9C,EAAA,CArHID,UAAoB;AAAA2D,EAAA,GAApB3D,UAAoB;AAuH1B,eAAeA,UAAU;AAAC,IAAA2D,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}