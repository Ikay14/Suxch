{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\DELL\\\\Documents\\\\projects\\\\suxch\\\\chat-client\\\\src\\\\components\\\\Chat\\\\ChatWindow.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport './ChatWindow.css';\nimport MessageList from './MessageList';\nimport MessageInput from './MessageInput';\nimport UploadedFiles from './UploadedFiles';\nimport { FaPaperclip } from 'react-icons/fa';\nimport io from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SOCKET_SERVER_URL = 'http://localhost:8080/chat';\nconst ChatWindow = () => {\n  _s();\n  const {\n    userId,\n    receiverId\n  } = useParams();\n  const history = useHistory();\n  const [uploadedFiles, setUploadedFiles] = useState([]);\n  const [socket, setSocket] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [clientId, setClientId] = useState(null);\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    const storedUserId = localStorage.getItem('userId');\n    if (!token || !storedUserId || storedUserId !== userId) {\n      history.replace('/login');\n      return;\n    }\n    const newSocket = io(SOCKET_SERVER_URL, {\n      path: '/chat/socket.io',\n      query: {\n        userId\n      },\n      auth: {\n        token: `Bearer ${token}`\n      },\n      transports: ['websocket', 'polling'],\n      withCredentials: true\n    });\n    setSocket(newSocket);\n    newSocket.on('connect', () => {\n      var _newSocket$id;\n      console.log('Connected with ID:', newSocket.id);\n      setClientId((_newSocket$id = newSocket.id) !== null && _newSocket$id !== void 0 ? _newSocket$id : null);\n      if (receiverId) {\n        newSocket.emit('join_conversation', {\n          userId,\n          receiverId\n        });\n      }\n    });\n    newSocket.on('new_message', message => {\n      console.log('New message:', message);\n      setMessages(prev => [...prev, message]);\n    });\n    newSocket.on('file-sent', fileMessage => {\n      setMessages(prev => [...prev, fileMessage]);\n    });\n    newSocket.on('connect_error', err => {\n      console.error('Connection error:', err);\n      if (err.message.includes('auth')) {\n        localStorage.clear();\n        history.push('/login');\n      }\n    });\n    return () => {\n      newSocket.disconnect();\n    };\n  }, [userId, receiverId, history]);\n  const handleFileUpload = event => {\n    if (event.target.files && event.target.files[0] && socket) {\n      const file = event.target.files[0];\n      setUploadedFiles(prevFiles => [...prevFiles, file]);\n      const formData = new FormData();\n      formData.append('file', file);\n      formData.append('senderId', userId);\n      if (receiverId) {\n        formData.append('receiverId', receiverId);\n      }\n      socket.emit('fileUpload', formData, response => {\n        if (response.status === 'success') {\n          console.log('File uploaded successfully:', response.data);\n        } else {\n          console.error('File upload failed:', response.message);\n        }\n      });\n    }\n  };\n  const handleSendMessage = message => {\n    if (socket) {\n      const messageData = receiverId ? {\n        senderId: userId,\n        receiverId,\n        content: message\n      } : {\n        senderId: userId,\n        content: message\n      }; // For group chats\n\n      socket.emit('send_message', messageData, response => {\n        if (response.status === 'success') {\n          console.log('Message sent successfully:', response.data);\n        } else {\n          console.error('Message sending failed:', response.message);\n        }\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: [\"Chat Room - User: \", localStorage.getItem('username')]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 17\n      }, this), clientId && /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Connection ID: \", clientId]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 30\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-content\",\n      children: [/*#__PURE__*/_jsxDEV(MessageList, {\n        messages: messages,\n        currentUserId: userId\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(UploadedFiles, {\n        files: uploadedFiles\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-input-area\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"file-upload\",\n          className: \"file-upload-icon\",\n          children: /*#__PURE__*/_jsxDEV(FaPaperclip, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"file-upload\",\n          type: \"file\",\n          style: {\n            display: 'none'\n          },\n          onChange: handleFileUpload\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(MessageInput, {\n          onSend: handleSendMessage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 9\n  }, this);\n};\n_s(ChatWindow, \"woX+LMSpS/Pv791B/tSMPtfRnv8=\", false, function () {\n  return [useParams, useHistory];\n});\n_c = ChatWindow;\nexport default ChatWindow;\nvar _c;\n$RefreshReg$(_c, \"ChatWindow\");","map":{"version":3,"names":["React","useState","useEffect","useParams","useHistory","MessageList","MessageInput","UploadedFiles","FaPaperclip","io","jsxDEV","_jsxDEV","SOCKET_SERVER_URL","ChatWindow","_s","userId","receiverId","history","uploadedFiles","setUploadedFiles","socket","setSocket","messages","setMessages","clientId","setClientId","token","localStorage","getItem","storedUserId","replace","newSocket","path","query","auth","transports","withCredentials","on","_newSocket$id","console","log","id","emit","message","prev","fileMessage","err","error","includes","clear","push","disconnect","handleFileUpload","event","target","files","file","prevFiles","formData","FormData","append","response","status","data","handleSendMessage","messageData","senderId","content","className","children","fileName","_jsxFileName","lineNumber","columnNumber","currentUserId","htmlFor","type","style","display","onChange","onSend","_c","$RefreshReg$"],"sources":["C:/Users/DELL/Documents/projects/suxch/chat-client/src/components/Chat/ChatWindow.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport './ChatWindow.css';\nimport MessageList from './MessageList';\nimport MessageInput from './MessageInput';\nimport UploadedFiles from './UploadedFiles';\nimport { FaPaperclip } from 'react-icons/fa';\nimport io, { Socket } from 'socket.io-client';\nimport { stopTyping } from 'src/services/socket';\n\nconst SOCKET_SERVER_URL = 'http://localhost:8080/chat';\n\ninterface ChatParams {\n    userId: string;\n    receiverId?: string; \n}\n\nconst ChatWindow: React.FC = () => {\n    const { userId, receiverId } = useParams<ChatParams>();\n    const history = useHistory();\n    const [uploadedFiles, setUploadedFiles] = useState<File[]>([]);\n    const [socket, setSocket] = useState<Socket | null>(null);\n    const [messages, setMessages] = useState<any[]>([]);\n    const [clientId, setClientId] = useState<string | null>(null);\n\n    useEffect(() => {\n        const token = localStorage.getItem('token');\n        const storedUserId = localStorage.getItem('userId');\n        \n        if (!token || !storedUserId || storedUserId !== userId) {\n            history.replace('/login');\n            return;\n        }\n    \n        const newSocket = io(SOCKET_SERVER_URL, {\n            path: '/chat/socket.io',\n            query: { userId },\n            auth: { token: `Bearer ${token}` },\n            transports: ['websocket', 'polling'],\n            withCredentials: true\n        });\n    \n        setSocket(newSocket);\n    \n        newSocket.on('connect', () => {\n            console.log('Connected with ID:', newSocket.id);\n            setClientId(newSocket.id ?? null);\n            \n            if (receiverId) {\n                newSocket.emit('join_conversation', { userId, receiverId });\n            }\n        });\n    \n        newSocket.on('new_message', (message) => {\n            console.log('New message:', message);\n            setMessages(prev => [...prev, message]);\n        });\n    \n        newSocket.on('file-sent', (fileMessage) => {\n            setMessages(prev => [...prev, fileMessage]);\n        });\n    \n        newSocket.on('connect_error', (err) => {\n            console.error('Connection error:', err);\n            if (err.message.includes('auth')) {\n                localStorage.clear();\n                history.push('/login');\n            }\n        });\n    \n        return () => {\n            newSocket.disconnect();\n        };\n    }, [userId, receiverId, history]);\n\n    \n    const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n        if (event.target.files && event.target.files[0] && socket) {\n            const file = event.target.files[0];\n            setUploadedFiles((prevFiles) => [...prevFiles, file]);\n\n            const formData = new FormData();\n            formData.append('file', file);\n            formData.append('senderId', userId);\n            if (receiverId) {\n                formData.append('receiverId', receiverId);\n            }\n\n            socket.emit('fileUpload', formData, (response: any) => {\n                if (response.status === 'success') {\n                    console.log('File uploaded successfully:', response.data);\n                } else {\n                    console.error('File upload failed:', response.message);\n                }\n            });\n        }\n    };\n\n    const handleSendMessage = (message: string) => {\n        if (socket) {\n            const messageData = receiverId \n                ? { senderId: userId, receiverId, content: message }\n                : { senderId: userId, content: message }; // For group chats\n\n            socket.emit('send_message', messageData, (response: any) => {\n                if (response.status === 'success') {\n                    console.log('Message sent successfully:', response.data);\n                } else {\n                    console.error('Message sending failed:', response.message);\n                }\n            });\n        }\n    };\n\n    return (\n        <div className=\"chat-container\">\n            <div className=\"chat-header\">\n                <h1>Chat Room - User: {localStorage.getItem('username')}</h1>\n                {clientId && <p>Connection ID: {clientId}</p>}\n            </div>\n            <div className=\"chat-content\">\n                <MessageList messages={messages} currentUserId={userId} />\n                <UploadedFiles files={uploadedFiles} />\n                <div className=\"chat-input-area\">\n                    <label htmlFor=\"file-upload\" className=\"file-upload-icon\">\n                        <FaPaperclip />\n                    </label>\n                    <input\n                        id=\"file-upload\"\n                        type=\"file\"\n                        style={{ display: 'none' }}\n                        onChange={handleFileUpload}\n                    />\n                    <MessageInput onSend={handleSendMessage} />\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default ChatWindow;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}