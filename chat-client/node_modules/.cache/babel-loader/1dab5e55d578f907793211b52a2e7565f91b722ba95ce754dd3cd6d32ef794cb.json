{"ast":null,"code":"var _SocketService;\nimport { io } from 'socket.io-client';\nclass SocketService {\n  constructor() {\n    this.socket = null;\n  }\n  static getInstance() {\n    if (!SocketService.instance) {\n      SocketService.instance = new SocketService();\n    }\n    return SocketService.instance;\n  }\n  initializeSocket(token) {\n    return new Promise((resolve, reject) => {\n      var _this$socket;\n      if ((_this$socket = this.socket) !== null && _this$socket !== void 0 && _this$socket.connected) return resolve(this.socket);\n      const cleanToken = token.replace('Bearer ', '');\n      const token = localStorage.getItem('accessToken');\n      const userId = localStorage.getItem('userId');\n      if (token && userId) {\n        socketService.initializeSocket(token).then(() => console.log('WebSocket initialized after refresh')).catch(err => console.error('Failed to reconnect:', err.message));\n      }\n      this.socket = io('http://localhost:8080', {\n        path: '/socket.io',\n        auth: {\n          token: cleanToken\n        },\n        transports: ['websocket'],\n        reconnectionAttempts: 5,\n        reconnectionDelay: 2000,\n        query: {\n          userId,\n          token: cleanToken\n        },\n        withCredentials: true\n      });\n      this.socket.on('connect', () => {\n        console.log(\"WebSocket connected\");\n        resolve(this.socket);\n      });\n      this.socket.on('disconnect', () => {\n        console.log('Disconnected. Retrying...');\n        setTimeout(() => this.initializeSocket(token), 5000);\n      });\n      this.socket.on('connect_error', err => {\n        console.error('Connection error:', err.message);\n        reject(err);\n      });\n    });\n  }\n  onConnectionStatusChange(callback) {\n    if (!this.socket) return;\n    this.socket.on('connect', () => callback('connected'));\n    this.socket.on('disconnect', () => callback('disconnected'));\n    this.socket.on('connect_error', () => callback('error'));\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n      console.log(\"ðŸ”Œ WebSocket disconnected\");\n    }\n  }\n}\n_SocketService = SocketService;\nSocketService.instance = void 0;\nexport const socketService = SocketService.getInstance();","map":{"version":3,"names":["io","SocketService","constructor","socket","getInstance","instance","initializeSocket","token","Promise","resolve","reject","_this$socket","connected","cleanToken","replace","localStorage","getItem","userId","socketService","then","console","log","catch","err","error","message","path","auth","transports","reconnectionAttempts","reconnectionDelay","query","withCredentials","on","setTimeout","onConnectionStatusChange","callback","disconnect","_SocketService"],"sources":["C:/Users/DELL/Documents/projects/suxch/chat-client/src/services/socket.ts"],"sourcesContent":["import { io, Socket } from 'socket.io-client';\n\nclass SocketService {\n  private static instance: SocketService;\n  socket: Socket | null = null;\n\n  public static getInstance(): SocketService {\n    if (!SocketService.instance) {\n      SocketService.instance = new SocketService();\n    }\n    return SocketService.instance;\n  }\n\n  initializeSocket(token: string): Promise<Socket> {\n    return new Promise((resolve, reject) => {\n      if (this.socket?.connected) return resolve(this.socket);\n\n      const cleanToken = token.replace('Bearer ', '');\n      const token = localStorage.getItem('accessToken');\nconst userId = localStorage.getItem('userId');\n\n\n      if (token && userId) {\n        socketService.initializeSocket(token)\n          .then(() => console.log('WebSocket initialized after refresh'))\n          .catch((err) => console.error('Failed to reconnect:', err.message));\n      }\n\n      this.socket = io('http://localhost:8080', {\n        path: '/socket.io',\n        auth: { token: cleanToken },\n        transports: ['websocket'],\n        reconnectionAttempts: 5, \n        reconnectionDelay: 2000, \n        query: { userId, token: cleanToken },\n        withCredentials: true,\n      });\n\n      this.socket.on('connect', () => {\n        console.log(\"WebSocket connected\");\n        resolve(this.socket!);\n      });\n\n      this.socket.on('disconnect', () => {\n        console.log('Disconnected. Retrying...');\n        setTimeout(() => this.initializeSocket(token), 5000); \n      });\n\n      this.socket.on('connect_error', (err) => {\n        console.error('Connection error:', err.message);\n        reject(err);\n      });\n    });\n\n    \n  }\n\n  onConnectionStatusChange(callback: (status: 'connected' | 'disconnected' | 'error') => void) {\n    if (!this.socket) return;\n\n    this.socket.on('connect', () => callback('connected'));\n    this.socket.on('disconnect', () => callback('disconnected'));\n    this.socket.on('connect_error', () => callback('error'));\n  }\n\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n      console.log(\"ðŸ”Œ WebSocket disconnected\");\n    }\n  }\n}\n\nexport const socketService = SocketService.getInstance();\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}